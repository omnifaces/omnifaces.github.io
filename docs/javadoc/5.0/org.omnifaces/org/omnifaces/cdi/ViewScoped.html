<!DOCTYPE HTML>
<html lang>
<head>
<!-- Generated by javadoc (21) -->
<title>ViewScoped (OmniFaces 5.0-SNAPSHOT API)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="description" content="declaration: module: org.omnifaces, package: org.omnifaces.cdi, annotation type: ViewScoped">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../script-dir/jquery-ui.min.css" title="Style">
<script type="text/javascript" src="../../../../script.js"></script>
<script type="text/javascript" src="../../../../script-dir/jquery-3.6.1.min.js"></script>
<script type="text/javascript" src="../../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">var pathtoroot = "../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top"><button id="navbar-toggle-button" aria-controls="navbar-top" aria-expanded="false" aria-label="Toggle navigation links"><span class="nav-bar-toggle-icon">&nbsp;</span><span class="nav-bar-toggle-icon">&nbsp;</span><span class="nav-bar-toggle-icon">&nbsp;</span></button>
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../module-summary.html">Module</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="class-use/ViewScoped.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../index-files/index-1.html">Index</a></li>
<li><a href="../../../../help-doc.html#class">Help</a></li>
</ul>
<ul class="sub-nav-list-small">
<li>
<p>Summary:</p>
<ul>
<li>Field</li>
<li>Required</li>
<li><a href="#annotation-interface-optional-element-summary">Optional</a></li>
</ul>
</li>
<li>
<p>Detail:</p>
<ul>
<li>Field</li>
<li><a href="#annotation-interface-element-detail">Element</a></li>
</ul>
</li>
</ul>
</div>
<div class="sub-nav">
<div id="navbar-sub-list">
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Required&nbsp;|&nbsp;</li>
<li><a href="#annotation-interface-optional-element-summary">Optional</a></li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#annotation-interface-element-detail">Element</a></li>
</ul>
</div>
<div class="nav-list-search"><a href="../../../../search.html">SEARCH</a>
<input type="text" id="search-input" disabled placeholder="Search">
<input type="reset" id="reset-button" disabled value="reset">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="module-label-in-type">Module</span>&nbsp;<a href="../../../module-summary.html">org.omnifaces</a></div>
<div class="sub-title"><span class="package-label-in-type">Package</span>&nbsp;<a href="package-summary.html">org.omnifaces.cdi</a></div>
<h1 title="Annotation Interface ViewScoped" class="title">Annotation Interface ViewScoped</h1>
</div>
<section class="class-description" id="class-description">
<hr>
<div class="type-signature"><span class="annotations"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/annotation/Inherited.html" title="class or interface in java.lang.annotation" class="external-link">@Inherited</a>
<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/annotation/Documented.html" title="class or interface in java.lang.annotation" class="external-link">@Documented</a>
<a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/enterprise/context/NormalScope.html" title="class or interface in jakarta.enterprise.context" class="external-link">@NormalScope</a>(<a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/enterprise/context/NormalScope.html#passivating()" title="class or interface in jakarta.enterprise.context" class="external-link">passivating</a>=true)
<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/annotation/Retention.html" title="class or interface in java.lang.annotation" class="external-link">@Retention</a>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/annotation/RetentionPolicy.html#RUNTIME" title="class or interface in java.lang.annotation" class="external-link">RUNTIME</a>)
<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/annotation/Target.html" title="class or interface in java.lang.annotation" class="external-link">@Target</a>({<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/annotation/ElementType.html#TYPE" title="class or interface in java.lang.annotation" class="external-link">TYPE</a>,<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/annotation/ElementType.html#METHOD" title="class or interface in java.lang.annotation" class="external-link">METHOD</a>,<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/annotation/ElementType.html#FIELD" title="class or interface in java.lang.annotation" class="external-link">FIELD</a>})
</span><span class="modifiers">public @interface </span><span class="element-name type-name-label">ViewScoped</span></div>
<div class="block"><p>
 The CDI view scope annotation, with more optimal handling of bean destroy as compared to standard Faces one.
 <p>
 In standard Faces, the <code>&#64;</code><a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/annotation/PreDestroy.html" title="class or interface in jakarta.annotation" class="external-link"><code>PreDestroy</code></a> annotated method on a view scoped bean is only
 invoked when the session expires.
 However, there may be cases when it's desirable to immediately destroy a view scoped bean as well when the browser
 <code>unload</code> event is invoked. I.e. when the user navigates away by GET, or closes the browser tab/window.
 The standard Faces view scope does not support this. Since OmniFaces 2.2, this CDI view scope annotation
 will guarantee that the <code>&#64;PreDestroy</code> annotated method is also invoked on browser unload. This trick
 is done by <code>navigator.sendBeacon</code>. For browsers not supporting <code>navigator.sendBeacon</code>, it will
 fallback to a synchronous XHR request.
 <p>
 Since OmniFaces 2.3, the unload has been further improved to also physically remove the associated Faces view state
 from Faces implementation's internal LRU map in case of server side state saving, hereby further decreasing the risk
 at <code>ViewExpiredException</code> on the other views which were created/opened earlier. As side effect of this
 change, the <code>&#64;PreDestroy</code> annotated method of any standard Faces view scoped beans referenced in the
 same view as the OmniFaces CDI view scoped bean will also guaranteed be invoked on browser unload.
 <p>
 Since OmniFaces 2.6, this annotation got a new attribute: <code>saveInViewState</code>. When using client side state
 saving, this attribute can be set to <code>true</code> in order to force Faces to store whole view scoped bean
 instances annotated with this annotation in the Faces view state instead of in the HTTP session. For more detail, see
 the <a href="#saveInViewState()"><code>saveInViewState()</code></a>.
 <p>
 In a nutshell: if you want the <code>&#64;PreDestroy</code> to be invoked on browser
 unload too, then use OmniFaces 2.2+ with this view scope annotation. Or, if you want to store whole view scoped beans
 in the Faces view state when using client side state saving, then use OmniFaces 2.6+ with this view scope annotation
 and the <code>saveInViewState</code> attribute set to <code>true</code>.
 <p>
 Related Faces issues:
 <ul>
 <li><a href="https://github.com/eclipse-ee4j/mojarra/issues/1355">Mojarra issue 1355</a>
 <li><a href="https://github.com/eclipse-ee4j/mojarra/issues/1843">Mojarra issue 1843</a>
 <li><a href="https://github.com/jakartaee/faces/issues/905">Faces spec issue 905</a>
 </ul>

 <h2 id="usage-heading">Usage</h2>
 <p>
 Just use it the usual way as all other CDI scopes. Watch out with IDE autocomplete on import that you don't
 accidentally import standard Faces own one.
 <pre>
 import jakarta.inject.Named;
 import org.omnifaces.cdi.ViewScoped;

 &#64;Named
 &#64;ViewScoped
 public class OmniCDIViewScopedBean implements Serializable {}
 </pre>
 <p>
 Please note that the bean <strong>must</strong> implement <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/Serializable.html" title="class or interface in java.io" class="external-link"><code>Serializable</code></a>, otherwise the CDI implementation
 will throw an exception about the bean not being passivation capable.
 <p>
 Under the covers, CDI managed beans with this scope are via <a href="viewscope/ViewScopeManager.html" title="class in org.omnifaces.cdi.viewscope"><code>ViewScopeManager</code></a> by default stored in the session
 scope by an <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/UUID.html" title="class or interface in java.util" class="external-link"><code>UUID</code></a> based key which is referenced in Faces own view map as available by
 <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/faces/component/UIViewRoot.html#getViewMap()" title="class or interface in jakarta.faces.component" class="external-link"><code>UIViewRoot.getViewMap()</code></a>. They are not stored in the Faces view state itself as that would be rather expensive
 in case of client side state saving.
 <p>
 In case you are using client side state saving by having the <code>jakarta.faces.STATE_SAVING_METHOD</code> context
 parameter set to <code>true</code> along with a valid <code>faces/ClientSideSecretKey</code> in <code>web.xml</code>
 as below,
 <pre>
 &lt;context-param&gt;
     &lt;param-name&gt;jakarta.faces.STATE_SAVING_METHOD&lt;/param-name&gt;
     &lt;param-value&gt;client&lt;/param-value&gt;
 &lt;/context-param&gt;
 &lt;env-entry&gt;
     &lt;env-entry-name&gt;faces/ClientSideSecretKey&lt;/env-entry-name&gt;
     &lt;env-entry-type&gt;java.lang.String&lt;/env-entry-type&gt;
     &lt;env-entry-value&gt;&lt;!-- See https://stackoverflow.com/q/35102645/157882 --&gt;&lt;/env-entry-value&gt;
 &lt;/env-entry&gt;
 </pre>
 <p>
 And you explicitly want to store the whole view scoped bean instance in the Faces view state, then set the annotation's
 <code>saveInViewState</code> attribute to <code>true</code>.
 <pre>
 import jakarta.inject.Named;
 import org.omnifaces.cdi.ViewScoped;

 &#64;Named
 &#64;ViewScoped(saveInViewState=true)
 public class OmniCDIViewScopedBean implements Serializable {}
 </pre>
 <p>
 It's very important that you understand that this setting has potentially a major impact in the size of the Faces view
 state, certainly when the view scoped bean instance holds "too much" data, such as a collection of entities for a
 data table, and that such beans will in fact <strong>never</strong> expire as they are stored entirely in the
 <code>jakarta.faces.ViewState</code> hidden input field in the HTML page. Moreover, the
 <code>&#64;</code><a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/annotation/PreDestroy.html" title="class or interface in jakarta.annotation" class="external-link"><code>PreDestroy</code></a> annotated method on such bean will explicitly <strong>never</strong> be invoked,
 even not on an unload as it's quite possible to save or cache the page source and re-execute it at a (much) later
 moment.
 <p>
 It's therefore strongly recommended to use this setting only on a view scoped bean instance which is exclusively used
 to keep track of the dynamically controlled form state, such as <code>disabled</code>, <code>readonly</code> and
 <code>rendered</code> attributes which are controlled by ajax events.
 <p>
 This setting is NOT recommended when using server side state saving. It has basically no effect and it only adds
 unnecessary serialization overhead. The system will therefore throw an <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/IllegalStateException.html" title="class or interface in java.lang" class="external-link"><code>IllegalStateException</code></a> on such
 condition.

 <h2 id="configuration-heading">Configuration</h2>
 <p>
 By default, the maximum number of active view scopes is hold in a LRU map in HTTP session with a default size equal
 to the first non-null value of the following context parameters:
 <ul>
 <li><a href="viewscope/ViewScopeManager.html#PARAM_NAME_MAX_ACTIVE_VIEW_SCOPES">"org.omnifaces.VIEW_SCOPE_MANAGER_MAX_ACTIVE_VIEW_SCOPES"</a> (OmniFaces)</li>
 <li><a href="viewscope/ViewScopeManager.html#PARAM_NAME_MOJARRA_NUMBER_OF_VIEWS">"com.sun.faces.numberOfLogicalViews"</a> (Mojarra-specific)</li>
 <li><a href="viewscope/ViewScopeManager.html#PARAM_NAME_MYFACES_NUMBER_OF_VIEWS">"org.apache.myfaces.NUMBER_OF_VIEWS_IN_SESSION"</a> (MyFaces-specific)</li>
 </ul>
 <p>If none of those context parameters are present, then a default size of
 <a href="viewscope/ViewScopeManager.html#DEFAULT_MAX_ACTIVE_VIEW_SCOPES">20</a> will be used. When a view scoped
 bean is evicted from the LRU map, then its <code>&#64;PreDestroy</code> will also guaranteed to be invoked.
 <p>
 This setting has no effect when <code>saveInViewState</code> attribute is set to <code>true</code>.

 <h2 id="using-window-onbeforeunload-heading">Using window.onbeforeunload</h2>
 <p>
 If you have a custom <code>onbeforeunload</code> handler, then it's strongly recommended to use plain vanilla JS
 <code>window.onbeforeunload = function</code> instead of e.g. jQuery <code>$(window).on("beforeunload", function)</code>
 or DOM <code>window.addEventListener("beforeunload", function)</code> for this. This way the <code>@ViewScoped</code>
 unload can detect it and take it into account and continue to work properly. Otherwise the view scoped bean will
 still be destroyed in background even when the user cancels and decides to stay in the same page.
 <p>
 Below is a kickoff example how to properly register it, assuming jQuery is available, and that "stateless" forms
 and inputs (for which you don't want to trigger the unsaved data warning) have the class <code>stateless</code> set:
 <pre>
 $(document).on("change", "form:not(.stateless) :input:not(.stateless)", function() {
     $("body").data("unsavedchanges", true);
 });
 OmniFaces.Util.addSubmitListener(function() { // This hooks on Mojarra/MyFaces/PrimeFaces ajax submit events too.
     $("body").data("unsavedchanges", false);
 });
 window.onbeforeunload = function() {
     return $("body").data("unsavedchanges") ? "You have unsaved data. Are you sure you wish to leave this page?" : null;
 };
 </pre>

 <h2 id="using-download-links-heading">Using download links</h2>
 <p>
 If you have a synchronous download link as in <code>&lt;a href="/path/to/file.ext"&gt;</code>, then the unload will
 also be triggered. For HTML5-capable browsers it's sufficient to add the <code>download</code> attribute representing
 the file name you'd like to use in the client specific "Save As" dialogue.
 <pre>
 &lt;a href="/path/to/file.ext" download="file.ext"&gt;download&lt;/a&gt;
 </pre>
 <p>
 When this attribute is present, then the browser won't anymore trigger the unload event. In case your target browser
 does not <a href="https://caniuse.com/#feat=download">support</a> it, then you'd need to explicitly disable the
 OmniFaces unload event as follows:
 <pre>
 &lt;a href="/path/to/file.ext" onclick="OmniFaces.Unload.disable();"&gt;download&lt;/a&gt;
 </pre>
 <p>
 An alternative is to explicitly open the download in a new tab/window. Decent browsers, even these not supporting the
 <code>download</code> attribute, will usually automatically close the newly opened tab/window when a response with
 <code>Content-Disposition: attachment</code> is received.
 <pre>
 &lt;a href="/path/to/file.ext" target="_blank"&gt;download&lt;/a&gt;
 </pre>

 <h2 id="detecting-unload-requests-heading">Detecting unload requests</h2>
 <p>
 When the unload request has hit your servlet filter or authentication mechanism or whatever global listener/observer,
 and you would like to be able to detect them, so that you can exclude them from the logic, then you can use
 <a href="viewscope/ViewScopeManager.html#isUnloadRequest(jakarta.servlet.http.HttpServletRequest)"><code>ViewScopeManager.isUnloadRequest(jakarta.servlet.http.HttpServletRequest)</code></a> or
 <a href="viewscope/ViewScopeManager.html#isUnloadRequest(jakarta.faces.context.FacesContext)"><code>ViewScopeManager.isUnloadRequest(FacesContext)</code></a>, depending on whether the
 <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/faces/context/FacesContext.html" title="class or interface in jakarta.faces.context" class="external-link"><code>FacesContext</code></a> is available in the current context. You should always ensure that the flow just continues for
 them, else the unload requests won't be able to do their work of explicitly destroying the bean and state.
 <p>
 Here is an example assuming that you're in a servlet filter:
 <pre>
 if (!ViewScopeManager.isUnloadRequest(request)) {
     // Do actual job here.
 }

 chain.doFilter(request, response); // Ensure that this just continues!
 </pre></div>
<dl class="notes">
<dt>Since:</dt>
<dd>1.6</dd>
<dt>Author:</dt>
<dd>Radu Creanga &lt;rdcrng@gmail.com&gt;, Bauke Scholtz</dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list">
<li><a href="viewscope/ViewScopeExtension.html" title="class in org.omnifaces.cdi.viewscope"><code>ViewScopeExtension</code></a></li>
<li><a href="viewscope/ViewScopeContext.html" title="class in org.omnifaces.cdi.viewscope"><code>ViewScopeContext</code></a></li>
<li><a href="viewscope/ViewScopeManager.html" title="class in org.omnifaces.cdi.viewscope"><code>ViewScopeManager</code></a></li>
<li><a href="viewscope/ViewScopeStorage.html" title="interface in org.omnifaces.cdi.viewscope"><code>ViewScopeStorage</code></a></li>
<li><a href="viewscope/ViewScopeStorageInSession.html" title="class in org.omnifaces.cdi.viewscope"><code>ViewScopeStorageInSession</code></a></li>
<li><a href="viewscope/ViewScopeStorageInViewState.html" title="class in org.omnifaces.cdi.viewscope"><code>ViewScopeStorageInViewState</code></a></li>
<li><a href="viewscope/ViewScopeEventListener.html" title="class in org.omnifaces.cdi.viewscope"><code>ViewScopeEventListener</code></a></li>
<li><a href="BeanStorage.html" title="class in org.omnifaces.cdi"><code>BeanStorage</code></a></li>
<li><a href="../util/cache/LruCache.html" title="class in org.omnifaces.util.cache"><code>LruCache</code></a></li>
<li><a href="../viewhandler/OmniViewHandler.html" title="class in org.omnifaces.viewhandler"><code>OmniViewHandler</code></a></li>
<li><a href="../context/OmniExternalContext.html" title="class in org.omnifaces.context"><code>OmniExternalContext</code></a></li>
<li><a href="../context/OmniExternalContextFactory.html" title="class in org.omnifaces.context"><code>OmniExternalContextFactory</code></a></li>
</ul>
</dd>
</dl>
</section>
<section class="summary">
<ul class="summary-list">
<!-- =========== ANNOTATION INTERFACE OPTIONAL MEMBER SUMMARY =========== -->
<li>
<section class="member-summary" id="annotation-interface-optional-element-summary">
<h2>Optional Element Summary</h2>
<div class="caption"><span>Optional Elements</span></div>
<div class="summary-table three-column-summary">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Optional Element</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color"><code>boolean</code></div>
<div class="col-second even-row-color"><code><a href="#saveInViewState()" class="member-name-link">saveInViewState</a></code></div>
<div class="col-last even-row-color">
<div class="block">
 Sets whether to save the view scoped bean instance in Faces view state instead of in HTTP session.</div>
</div>
</div>
</section>
</li>
</ul>
</section>
<section class="details" id="annotation-interface-element-detail">
<ul class="details-list">
<!-- ============ ANNOTATION INTERFACE MEMBER DETAIL =========== -->
<li>
<section class="member-details">
<h2>Element Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="saveInViewState()">
<h3>saveInViewState</h3>
<div class="member-signature"><span class="return-type">boolean</span>&nbsp;<span class="element-name">saveInViewState</span></div>
<div class="block"><p>
 Sets whether to save the view scoped bean instance in Faces view state instead of in HTTP session. By default,
 concrete view scoped bean instances are saved in HTTP session, also when client side state saving is enabled.
 This means, when the HTTP session expires, then the view scoped bean instances will also implicitly expire and
 be newly recreated upon a request in a new session. This may be undesirable when using client side state saving
 as it's intuitively expected that concrete view scoped beans are also saved in Faces view state.</div>
<dl class="notes">
<dt>Returns:</dt>
<dd>Whether to save the view scoped bean instance in Faces view state instead of in HTTP session.</dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/IllegalStateException.html" title="class or interface in java.lang" class="external-link">IllegalStateException</a></code> - When enabled while not using client side state saving.</dd>
<dt>Since:</dt>
<dd>2.6</dd>
</dl>
<dl class="notes">
<dt>Default:</dt>
<dd><code>false</code></dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
<footer role="contentinfo">
<hr>
<p class="legal-copy"><small>Copyright &#169; 2012&#x2013;2025 <a href="https://omnifaces.org">OmniFaces</a>. All rights reserved.</small></p>
</footer>
</div>
</div>
</body>
</html>
